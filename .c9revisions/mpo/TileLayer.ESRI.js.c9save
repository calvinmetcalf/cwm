{"ts":1346079142379,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"L.TileLayer.ESRI = L.TileLayer.extend({\r\n    initialize: function(url, options) {\r\n\t\tthis._baseUrl = url;\r\n\t\tthis._loadMetadata();\r\n\t\tthis._url = url + \"/tile/{z}/{y}/{x}.png\";\r\n\t\t\r\n\t\tL.Util.setOptions(this, options);\r\n\t},\r\n\t\r\n\t_loadMetadata: function() {\r\n\t\tthis._callbackId = \"esri_tilelayer_\" + (L.TileLayer.ESRI._callbackId++);\r\n\t\tvar that = this;\r\n\t\twindow[this._callbackId] = function(metadata) { \r\n\t    \tthat.metadata = metadata;\r\n\t    \tthat.attribution = metadata.copyrightText;\r\n\t    \tif (that._map.attributionControl) { that._map.attributionControl.addAttribution(that.attribution); }\r\n\t    \tthat._onMetadataLoaded();\r\n\t    };\r\n\t    \r\n\t    var url = this._baseUrl + L.Util.getParamString({ f: \"json\", callback: this._callbackId }),\r\n        \tscript = document.createElement(\"script\");\r\n\t        \r\n\t    script.type = \"text/javascript\";\r\n\t    script.src = url;\r\n\t    script.id = this._callbackId;\r\n\t    document.getElementsByTagName(\"head\")[0].appendChild(script);\t    \t\r\n\t},\r\n\t\r\n\t_onMetadataLoaded: function() {},\r\n\t\r\n\tonAdd: function(map, insertAtTheBottom) {\r\n\t\tthis._map = map;\r\n\t    if (!this.metadata) {\r\n\t    \tthis._onMetadataLoaded = L.Util.bind(function() {\r\n\t    \t\tL.TileLayer.prototype.onAdd.call(this, map, insertAtTheBottom);\r\n\t    \t}, this);\r\n\t    } else {\r\n\t    \tL.TileLayer.prototype.onAdd.call(this, map, insertAtTheBottom);\r\n\t    }\r\n\t },\r\n\t  \r\n\tonRemove: function(map) {\r\n\t   if (this._map.attributionControl) {\r\n\t     this._map.attributionControl.removeAttribution(this.attribution);\r\n\t   }\r\n\t}\r\n});\r\n\r\nL.TileLayer.ESRI._callbackId = 0;"]],"start1":0,"start2":0,"length1":0,"length2":1563}]],"length":1563}
